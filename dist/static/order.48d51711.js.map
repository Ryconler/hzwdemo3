{"version":3,"file":"order.48d51711.js","sources":["../../src/api/order.ts"],"sourcesContent":["import urlPrefixes from '@/constants/urlPrefixes'\nimport {\n  cookies,\n  http,\n  isAndroidApp,\n  isCzjApp,\n  isHzwApp,\n  isIosApp,\n  isMiniprogram,\n  isRkhy,\n  toLogin\n} from '@/utils'\nimport { ResultType } from '@/types/http'\nimport queryString from 'query-string'\nimport {\n  ConfirmOrderType,\n  CreateResultType,\n  OrderType,\n  RefundOrderType\n} from '@/types/order'\nimport { Toast } from 'vant'\n\nconst api = {\n  queryOrderConfirm: `${urlPrefixes.ccardomsapi}/ccard-oms-api/UOrder/confirmOrder.do`,\n  createOrder: `${urlPrefixes.ccardomsapi}/ccard-oms-api/UOrder/createOrder.do`,\n  queryOrderDetail: `${urlPrefixes.ccardomsapi}/ccard-oms-api/UOrder/queryOrderDetail.do`,\n  cancelOrder: `${urlPrefixes.ccardomsapi}/ccard-oms-api/UOrder/cancelOrder.do`,\n  queryRefundDetail: `${urlPrefixes.ccardomsapi}/ccard-oms-api/refund/detail.do`\n}\n\n/* 查询待确认订单  */\n/* http://mytest.kapi.haiziwang.com:3003/project/2876/interface/api/48945 */\nexport async function queryOrderConfirm(params: {\n  skuId: number | string\n  storeCode: string\n  shareKey?: string\n}) {\n  const query = queryString.stringify({\n    orderType: 1, //订单类型：1正价订单\n    ...params\n  })\n  const result: ResultType<ConfirmOrderType> = await http.get(\n    `${api.queryOrderConfirm}?${query}`\n  )\n  const { data, code } = result\n  if (code == '1') {\n    return data || null\n  } else {\n    throw result\n  }\n}\n\n/* 创建订单  */\n/* http://mytest.kapi.haiziwang.com:3003/project/2876/interface/api/48954 */\nexport async function createOrder(params: {\n  skuId: number | string\n  storeCode: string\n  num: number\n  orderPrice: number\n  payPrice: number\n  inviteCode?: string\n  shareKey?: string\n}) {\n  const query = queryString.parse(location.search)\n  const extInfo = []\n  const deviceCode = (query && query.deviceCode) ?? ''\n  if (deviceCode) {\n    extInfo.push({\n      labelKey: 'deviceCode',\n      labelName: '设备号',\n      labelValue: deviceCode\n    })\n  }\n  const orderSource = isCzjApp()\n    ? 1\n    : isHzwApp()\n    ? 2\n    : deviceCode //电玩充值\n    ? 12\n    : isRkhy()\n    ? 3\n    : (await isMiniprogram())\n    ? 9\n    : 8\n  const result: ResultType<CreateResultType> = await http.post(\n    `${api.createOrder}`,\n    `${queryString.stringify({\n      uid: cookies.get('uid'),\n      orderType: 1,\n      orderSource,\n      appPlatfrom: isIosApp() ? 1 : isAndroidApp() ? 2 : undefined,\n      appVersion: cookies.get('version'),\n      extInfo: JSON.stringify(extInfo),\n      ...params\n    })}`,\n    {\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded'\n      }\n    }\n  )\n  const { code, data } = result\n  if (code == '1') {\n    return data || null\n  } else {\n    throw result\n  }\n}\n\n/* 查询订单详情 */\nexport async function queryOrderDetail(orderId: string) {\n  const query = queryString.stringify({\n    orderId\n  })\n  const result: ResultType<OrderType> = await http.get(\n    `${api.queryOrderDetail}?${query}`\n  )\n  const { data, code } = result\n  if (code == '1') {\n    return data || null\n  } else {\n    throw result\n  }\n}\n\n/* 取消订单 */\nexport async function cancelOrder(orderId: string) {\n  const query = queryString.stringify({\n    orderId\n  })\n  const result: ResultType<null> = await http.get(`${api.cancelOrder}?${query}`)\n  const { msg, code } = result\n  if (code == '1') {\n    return msg\n  } else {\n    throw result\n  }\n}\n\n/* 退款详情 */\nexport async function queryRefundDetail(orderId: string) {\n  const query = queryString.stringify({\n    orderId\n  })\n  const result: ResultType<RefundOrderType> = await http.get(\n    `${api.queryRefundDetail}?${query}`\n  )\n  const { data, code } = result\n  if (code == '1') {\n    return data || null\n  } else {\n    throw result\n  }\n}\n"],"names":["api","urlPrefixes","queryOrderConfirm","params","__async","query","queryString","__spreadValues","result","http","data","code","queryOrderDetail","orderId","cancelOrder","msg","queryRefundDetail"],"mappings":"ooBAsBA,MAAMA,EAAM,CACV,kBAAmB,GAAGC,EAAY,mDAClC,YAAa,GAAGA,EAAY,kDAC5B,iBAAkB,GAAGA,EAAY,uDACjC,YAAa,GAAGA,EAAY,kDAC5B,kBAAmB,GAAGA,EAAY,4CACpC,EAIA,SAAsBC,EAAkBC,EAIrC,QAAAC,EAAA,sBACK,MAAAC,EAAQC,EAAY,UAAUC,EAAA,CAClC,UAAW,GACRJ,EACJ,EACKK,EAAuC,MAAMC,EAAK,IACtD,GAAGT,EAAI,qBAAqBK,GAAA,EAExB,CAAE,KAAAK,EAAM,KAAAC,CAAS,EAAAH,EACvB,GAAIG,GAAQ,IACV,OAAOD,GAAQ,KAET,MAAAF,CAEV,GA4DA,SAAsBI,EAAiBC,EAAiB,QAAAT,EAAA,sBAChD,MAAAC,EAAQC,EAAY,UAAU,CAClC,QAAAO,CAAA,CACD,EACKL,EAAgC,MAAMC,EAAK,IAC/C,GAAGT,EAAI,oBAAoBK,GAAA,EAEvB,CAAE,KAAAK,EAAM,KAAAC,CAAS,EAAAH,EACvB,GAAIG,GAAQ,IACV,OAAOD,GAAQ,KAET,MAAAF,CAEV,GAGA,SAAsBM,EAAYD,EAAiB,QAAAT,EAAA,sBAC3C,MAAAC,EAAQC,EAAY,UAAU,CAClC,QAAAO,CAAA,CACD,EACKL,EAA2B,MAAMC,EAAK,IAAI,GAAGT,EAAI,eAAeK,GAAO,EACvE,CAAE,IAAAU,EAAK,KAAAJ,CAAS,EAAAH,EACtB,GAAIG,GAAQ,IACH,OAAAI,EAED,MAAAP,CAEV,GAGA,SAAsBQ,EAAkBH,EAAiB,QAAAT,EAAA,sBACjD,MAAAC,EAAQC,EAAY,UAAU,CAClC,QAAAO,CAAA,CACD,EACKL,EAAsC,MAAMC,EAAK,IACrD,GAAGT,EAAI,qBAAqBK,GAAA,EAExB,CAAE,KAAAK,EAAM,KAAAC,CAAS,EAAAH,EACvB,GAAIG,GAAQ,IACV,OAAOD,GAAQ,KAET,MAAAF,CAEV"}