{"version":3,"file":"order-legacy.f4a10cf9.js","sources":["../../src/api/order.ts"],"sourcesContent":["import urlPrefixes from '@/constants/urlPrefixes'\nimport {\n  cookies,\n  http,\n  isAndroidApp,\n  isCzjApp,\n  isHzwApp,\n  isIosApp,\n  isMiniprogram,\n  isRkhy,\n  toLogin\n} from '@/utils'\nimport { ResultType } from '@/types/http'\nimport queryString from 'query-string'\nimport {\n  ConfirmOrderType,\n  CreateResultType,\n  OrderType,\n  RefundOrderType\n} from '@/types/order'\nimport { Toast } from 'vant'\n\nconst api = {\n  queryOrderConfirm: `${urlPrefixes.ccardomsapi}/ccard-oms-api/UOrder/confirmOrder.do`,\n  createOrder: `${urlPrefixes.ccardomsapi}/ccard-oms-api/UOrder/createOrder.do`,\n  queryOrderDetail: `${urlPrefixes.ccardomsapi}/ccard-oms-api/UOrder/queryOrderDetail.do`,\n  cancelOrder: `${urlPrefixes.ccardomsapi}/ccard-oms-api/UOrder/cancelOrder.do`,\n  queryRefundDetail: `${urlPrefixes.ccardomsapi}/ccard-oms-api/refund/detail.do`\n}\n\n/* 查询待确认订单  */\n/* http://mytest.kapi.haiziwang.com:3003/project/2876/interface/api/48945 */\nexport async function queryOrderConfirm(params: {\n  skuId: number | string\n  storeCode: string\n  shareKey?: string\n}) {\n  const query = queryString.stringify({\n    orderType: 1, //订单类型：1正价订单\n    ...params\n  })\n  const result: ResultType<ConfirmOrderType> = await http.get(\n    `${api.queryOrderConfirm}?${query}`\n  )\n  const { data, code } = result\n  if (code == '1') {\n    return data || null\n  } else {\n    throw result\n  }\n}\n\n/* 创建订单  */\n/* http://mytest.kapi.haiziwang.com:3003/project/2876/interface/api/48954 */\nexport async function createOrder(params: {\n  skuId: number | string\n  storeCode: string\n  num: number\n  orderPrice: number\n  payPrice: number\n  inviteCode?: string\n  shareKey?: string\n}) {\n  const query = queryString.parse(location.search)\n  const extInfo = []\n  const deviceCode = (query && query.deviceCode) ?? ''\n  if (deviceCode) {\n    extInfo.push({\n      labelKey: 'deviceCode',\n      labelName: '设备号',\n      labelValue: deviceCode\n    })\n  }\n  const orderSource = isCzjApp()\n    ? 1\n    : isHzwApp()\n    ? 2\n    : deviceCode //电玩充值\n    ? 12\n    : isRkhy()\n    ? 3\n    : (await isMiniprogram())\n    ? 9\n    : 8\n  const result: ResultType<CreateResultType> = await http.post(\n    `${api.createOrder}`,\n    `${queryString.stringify({\n      uid: cookies.get('uid'),\n      orderType: 1,\n      orderSource,\n      appPlatfrom: isIosApp() ? 1 : isAndroidApp() ? 2 : undefined,\n      appVersion: cookies.get('version'),\n      extInfo: JSON.stringify(extInfo),\n      ...params\n    })}`,\n    {\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded'\n      }\n    }\n  )\n  const { code, data } = result\n  if (code == '1') {\n    return data || null\n  } else {\n    throw result\n  }\n}\n\n/* 查询订单详情 */\nexport async function queryOrderDetail(orderId: string) {\n  const query = queryString.stringify({\n    orderId\n  })\n  const result: ResultType<OrderType> = await http.get(\n    `${api.queryOrderDetail}?${query}`\n  )\n  const { data, code } = result\n  if (code == '1') {\n    return data || null\n  } else {\n    throw result\n  }\n}\n\n/* 取消订单 */\nexport async function cancelOrder(orderId: string) {\n  const query = queryString.stringify({\n    orderId\n  })\n  const result: ResultType<null> = await http.get(`${api.cancelOrder}?${query}`)\n  const { msg, code } = result\n  if (code == '1') {\n    return msg\n  } else {\n    throw result\n  }\n}\n\n/* 退款详情 */\nexport async function queryRefundDetail(orderId: string) {\n  const query = queryString.stringify({\n    orderId\n  })\n  const result: ResultType<RefundOrderType> = await http.get(\n    `${api.queryRefundDetail}?${query}`\n  )\n  const { data, code } = result\n  if (code == '1') {\n    return data || null\n  } else {\n    throw result\n  }\n}\n"],"names":["async","orderId","query","queryString","stringify","result","http","get","api","data","code","msg","params","orderType","urlPrefixes","ccardomsapi"],"mappings":"4MA8GAA,eAAuCC,GAC/B,MAAAC,EAAQC,EAAYC,UAAU,CAClCH,QAAAA,IAEII,QAAsCC,EAAKC,IAC/C,GAAGC,KAAwBN,MAEvBO,KAAEA,EAAMC,KAAAA,GAASL,EACvB,GAAY,KAARK,EACF,OAAOD,GAAQ,KAET,MAAAJ,KAmBVL,eAAwCC,GAChC,MAAAC,EAAQC,EAAYC,UAAU,CAClCH,QAAAA,IAEII,QAA4CC,EAAKC,IACrD,GAAGC,KAAyBN,MAExBO,KAAEA,EAAMC,KAAAA,GAASL,EACvB,GAAY,KAARK,EACF,OAAOD,GAAQ,KAET,MAAAJ,KAzBVL,eAAkCC,GAC1B,MAAAC,EAAQC,EAAYC,UAAU,CAClCH,QAAAA,IAEII,QAAiCC,EAAKC,IAAO,GAAAC,KAAmBN,MAChES,IAAEA,EAAKD,KAAAA,GAASL,EACtB,GAAY,KAARK,EACK,OAAAC,EAED,MAAAN,KAvGVL,eAAwCY,GAKhC,MAAAV,EAAQC,EAAYC,UAAU,CAClCS,UAAW,KACRD,IAECP,QAA6CC,EAAKC,IACtD,GAAGC,KAAyBN,MAExBO,KAAEA,EAAMC,KAAAA,GAASL,EACvB,GAAY,KAARK,EACF,OAAOD,GAAQ,KAET,MAAAJ,KA1BV,MAAMG,KACkBM,EAAYC,mDAD9BP,GAEYM,EAAYC,eACPD,EAAYC,wDAH7BP,KAIYM,EAAYC,kDAJxBP,KAKkBM,EAAYC"}